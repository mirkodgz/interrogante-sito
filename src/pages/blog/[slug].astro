---
import { getCollection, getEntry } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import PageHero from "../../components/ui/PageHero";
import { render } from "astro:content";

const { slug } = Astro.params;
const post = await getEntry("blog", slug as string);

if (!post) {
    return Astro.redirect("/404");
}

const { Content } = await render(post);
const { title, cover, author, date } = post.data;

const formattedDate = date
    ? new Date(date).toLocaleDateString("es-ES", {
          year: "numeric",
          month: "long",
          day: "numeric",
      })
    : null;
---

<Layout title={`${title} - Blog`}>
    <main class="bg-white min-h-screen pb-24">
        {/* HERO SECTION - 45vh */}
        <PageHero
            client:load
            title={title}
            image={cover || ""}
            height="45vh"
            overlayOpacity="bg-black/60"
        >
            <div
                class="flex items-center justify-center gap-4 mt-6 text-white/90 font-serif text-lg"
            >
                {
                    author && (
                        <span class="uppercase tracking-widest text-sm font-sans font-bold text-white border-b border-white/30 pb-1">
                            {author}
                        </span>
                    )
                }
                {formattedDate && <span>|</span>}
                {formattedDate && <span>{formattedDate}</span>}
            </div>
        </PageHero>

        {/* CONTENT SECTION */}
        <article class="container mx-auto px-6 max-w-4xl py-16 md:py-24">
            <div
                class="prose prose-lg md:prose-xl prose-headings:font-serif prose-p:font-sans prose-p:text-gray-700 prose-a:text-primary max-w-none"
            >
                <Content />
            </div>
        </article>
    </main>
</Layout>
