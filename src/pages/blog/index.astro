---
import Layout from "../../layouts/Layout.astro";
import PageHero from "../../components/ui/PageHero";
import { getCollection } from "astro:content";

const posts = await getCollection("blog");
// Sort posts by date descending if dates are available, otherwise by title or just reverse order
const sortedPosts = posts.sort((a, b) => {
    const dateA = a.data.date ? new Date(a.data.date).getTime() : 0;
    const dateB = b.data.date ? new Date(b.data.date).getTime() : 0;
    return dateB - dateA;
});
---

<Layout title="Blog | Interrogante Spettacolo">
    <main class="bg-white min-h-screen pb-24">
        {/* HERO SECTION */}
        <PageHero
            client:load
            title="BLOG"
            image="https://res.cloudinary.com/dskliu1ig/image/upload/v1768568600/BlogHero-Background_v9fy5l.jpg"
            height="45vh"
            overlayOpacity="bg-black/70"
        >
            <p class="font-serif text-white/80 mt-4 text-lg italic">
                Reseñas, entrevistas y pensamientos.
            </p>
        </PageHero>

        {/* BLOG GRID */}
        <div class="container mx-auto px-6 max-w-7xl mt-16">
            <div
                class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-x-8 gap-y-12"
            >
                {
                    sortedPosts.map((post) => (
                        <a
                            href={`/blog/${post.slug}`}
                            class="group block h-full flex flex-col"
                        >
                            <div class="relative aspect-[4/3] overflow-hidden mb-6 bg-gray-100">
                                {post.data.cover ? (
                                    <img
                                        src={post.data.cover}
                                        alt={post.data.title}
                                        class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"
                                    />
                                ) : (
                                    <div class="w-full h-full flex items-center justify-center text-gray-400">
                                        <span class="text-xs uppercase">
                                            Sin Imagen
                                        </span>
                                    </div>
                                )}
                                <div class="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors duration-300" />
                            </div>

                            <div class="flex flex-col flex-grow">
                                <div class="flex items-center gap-3 text-xs uppercase tracking-widest text-gray-500 mb-3 font-sans font-bold">
                                    {post.data.date && (
                                        <span>
                                            {new Date(
                                                post.data.date,
                                            ).toLocaleDateString("es-ES", {
                                                year: "numeric",
                                                month: "short",
                                                day: "numeric",
                                            })}
                                        </span>
                                    )}
                                    {post.data.author && (
                                        <>
                                            <span class="w-1 h-1 rounded-full bg-gray-400" />
                                            <span>{post.data.author}</span>
                                        </>
                                    )}
                                </div>

                                <h2 class="font-nav text-2xl leading-tight mb-3 group-hover:text-primary transition-colors line-clamp-2">
                                    {post.data.title}
                                </h2>

                                {post.data.summary && (
                                    <p class="font-sans text-gray-600 line-clamp-3 text-sm leading-relaxed mb-4 flex-grow">
                                        {post.data.summary}
                                    </p>
                                )}

                                <span class="inline-block text-xs uppercase tracking-widest border-b border-black pb-0.5 self-start group-hover:border-primary group-hover:text-primary transition-colors">
                                    Leer Artículo
                                </span>
                            </div>
                        </a>
                    ))
                }
            </div>
        </div>
    </main>
</Layout>
